{
  "hash": "b759cb4c25ae2d497a5663187f24646f",
  "result": {
    "markdown": "---\ntitle: \"Overlaying a Normal Curve on a Histogram in R\"\nauthor: \n  - name: Henrik Kenneth Andersen\n    orcid: 0000-0001-6842-5337\n    email: henrik.andersen@soziologie.tu-chemnitz.de\n    affiliations: \n      - name: Chemnitz University of Technology\n        address: Thueringer Weg 9\n        city: Chemnitz \n        state: Saxony\n        postal-code: 09126\ndate: \"2022-11-25\"\ncategories: [R, linear regression, residual diagnostics]\ntoc: true \nsmooth-scroll: true\ncitation: true\nabstract: \"This brief blog post will show you how to overlay a normal density curve on a histogram. This can be helpful for comparing empirical distributions to the theoretical normal distribution, which comes up often in linear regression residual diagnostics.\"\n---\n\n\n## Introduction \n\nThose of us socialized in `SPSS` might remember being able to check a box labeled \"Display normal curve\" when creating a histogram. This was a really easy step and it made it straightforward to compare the empirical frequencies with an appropriate normal distribution. \n\n::: {layout-ncol=2}\n\n![](makeahistogram2.jpg)\n\n![](makeahistogram3.jpg)\n\n:::\n\nSource: https://ezspss.com/how-to-make-a-histogram-in-spss/\n\nWhen we apply ordinary linear regression, it is helpful to check the residual distribution for normality. Only if the residuals are normally distributed can the usual normal theory-based inference be applied. \n\nBut `R` doesn't offer an easy way to overlay a normal distribution in a histogram. But don't fret: this quick blog post will show you how to do it. \n\n## Simulating some data for demonstration \n\nLet's quickly simulate some data and then run a linear regression to inspect the normality of the residuals. \n\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(1234)\n\nn <- 1000L\nw <- rnorm(n = n, mean = 2, sd = 4)\ny <- 0.5 * w + rnorm(n = n, mean = 5, sd = 3)\n\ndf <- data.frame(w, y)\n\nm1 <- lm(formula = y ~ w, data = df)\nsummary(m1)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nlm(formula = y ~ w, data = df)\n\nResiduals:\n    Min      1Q  Median      3Q     Max \n-9.4982 -1.9317  0.0435  1.9611  9.2053 \n\nCoefficients:\n            Estimate Std. Error t value Pr(>|t|)    \n(Intercept)  4.96440    0.10293   48.23   <2e-16 ***\nw            0.54178    0.02332   23.23   <2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 2.94 on 998 degrees of freedom\nMultiple R-squared:  0.351,\tAdjusted R-squared:  0.3504 \nF-statistic: 539.8 on 1 and 998 DF,  p-value: < 2.2e-16\n```\n:::\n:::\n\n\n## Assessing normality of residuals\n\nWe can get the diagnostic plots using `plot()`. The plot for normality of the residuals is the second one. \n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot(m1, 2)\n```\n\n::: {.cell-output-display}\n![](normal-curve_files/figure-html/unnamed-chunk-2-1.png){width=672}\n:::\n:::\n\n\nThis is a Q-Q-plot. It shows the standardized residuals plotted against the theoretical standard normal distribution. The standard normal distribution tells us, for example, that about 2.5% of the density should be found 1.96 standard deviations below the mean. \n\n\n::: {.cell}\n\n```{.r .cell-code}\npnorm(-1.96, mean = 0, sd = 1)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 0.0249979\n```\n:::\n:::\n\n\nSo, if our empirical distribution were normal, then about 2.5% of the distribution should fall below that critical value. The closer the empirical distribution of the standardized residuals follows that of a standard normal distribution, the more nicely the points will fall directly on the diagonal line. \n\nThis isn't super complicated, by I have found it a bit difficult to explain to students sometimes. A histogram for assessing normality is, in my opinion, didactically a bit more easy to work with. \n\nWe can plot the residuals as a histogram easily, as well: \n\n\n::: {.cell}\n\n```{.r .cell-code}\nhist(m1$residuals, breaks = 20L, main = \"\")\n```\n\n::: {.cell-output-display}\n![](normal-curve_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n:::\n\n\nAt this point, we could decide to standardize the residuals by dividing each by the standard deviation, but that's not strictly necessary. \n\n## Overlaying a normal density curve\n\nBut let's say we wanted to overlay a nice normal distribution curve. What we can do is \n\n1. produce the histogram in terms of the density, rather than the frequencies \n2. calculate the density of the normal distribution using `dnorm()` and over the range of the residuals. \n\n\n::: {.cell}\n\n```{.r .cell-code}\nhist(m1$residuals, breaks = 20L, freq = FALSE, main = \"\")\n\n# Note that the sequence here must be called \"x\", otherwise dnorm() won't work \nx <- seq(from = round(min(m1$residuals), 1), \n         to   = round(max(m1$residuals), 1), \n         by   = 0.1)\n\ncurve(dnorm(x, mean = 0, sd = sd(m1$residuals)), add = TRUE)\n```\n\n::: {.cell-output-display}\n![](normal-curve_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n\nNow, if we wanted to look at the standardized residuals instead, we could do: \n\n\n::: {.cell}\n\n```{.r .cell-code}\nstd_res <- m1$residuals / sd(m1$residuals)\n\nhist(std_res, breaks = 20L, freq = FALSE, main = \"\")\n\nx <- seq(from = round(min(std_res), 1),\n         to   = round(max(std_res), 1),\n         by   = 0.1)\n\ncurve(dnorm(x, mean = 0, sd = 1), add = TRUE)\n```\n\n::: {.cell-output-display}\n![](normal-curve_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n:::\n\n\n## About the author \n\nHenrik Kenneth Andersen is a Postdoc at the Chemnitz University of Technology, Institute of Sociology. ",
    "supporting": [
      "normal-curve_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}